<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<canvas id="canvas"></canvas>
</body>
</html>
<script src="js/ball.js"></script>
<script src="js/utils.js"></script>
<script src="js/line.js"></script>
<script type="text/javascript">
	var canvas = document.getElementById('canvas');
	var W = canvas.width = 600,
		H = canvas.height = 600;
	var ctx = canvas.getContext('2d');
	var line = new Line(0,0,250,0);
	line.x = 100;
	line.y = 400;
	var angle = 10,
		grivaty = 0.2,
		bounce = -0.7;

	line.rotation = angle/180*Math.PI;
	var sin = Math.sin(line.rotation),
		cos = Math.cos(line.rotation);

	var ball = new Ball();
		ball.x = 100;
		ball.y = 100;

	(function drawFrame(){
		window.requestAnimationFrame(drawFrame);
		ctx.clearRect(0,0,W,H);

		ball.vy += grivaty;

		ball.x += ball.vx;
		ball.y += ball.vy;

		var bounds = line.getBounds();
		if(ball.x + ball.radius > bounds.x && ball.x - ball.radius < bounds.x + bounds.width){
			var x1 = ball.x - line.x,
				y1 = ball.y - line.y,    //ball与line的相对位置

				y2 = cos*y1 - sin*x1,    //旋转坐标
				vy1 = cos*ball.vy - sin*ball.vx;  //旋转速度
			if(y2 > -ball.radius && y2 < vy1){  //与线段的碰撞检测
			
			var x2 = cos*x1 + sin*y1,    //坐标旋转
				vx1 = cos*ball.vx + sin*ball.vy,  //速度旋转
				
				y2 = -ball.radius;
				vy1 *= bounce;
			//所有的东西旋转回去
				x1 = cos*x2 - sin*y2;
				y1 = cos*y2 + sin*x2;

				ball.vx = cos*vx1 - sin*vy1;
				ball.vy = cos*vy1 + sin*vx1;

				ball.x = x1 + line.x;
				ball.y = y1 + line.y;
			}
		}
//边界的碰撞
		if(ball.x - ball.radius < 0){
			ball.x = ball.radius;
			ball.vx *= bounce;
		}else if(ball.x + ball.radius > W){
			ball.x = W - ball.radius;
			ball.vx *= bounce;
		}

		if(ball.y - ball.radius < 0){
			ball.y = ball.radius;
			ball.vy *= bounce;
		}else if(ball.y + ball.radius > H){
			ball.y = H -ball.radius;
			ball.vy *= bounce;
		}

		ball.draw(ctx);
		line.draw(ctx);

	}())


</script>